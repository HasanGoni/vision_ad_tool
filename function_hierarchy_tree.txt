FUNCTION CALL HIERARCHY - ANOMALY SCORE ORGANIZER
==================================================

MAIN WORKFLOW FUNCTION (Entry Point)
â””â”€â”€ predict_and_organize_by_score (Cell 48)
    â”‚
    â”œâ”€â”€ STEP 0: Create Image Index
    â”‚   â””â”€â”€ create_image_index_dataframe
    â”‚       â””â”€â”€ Reads image_list_file â†’ Creates DataFrame
    â”‚
    â”œâ”€â”€ STEP 1: Run Predictions (EXTERNAL)
    â”‚   â””â”€â”€ predict_image_list_from_file_enhanced
    â”‚       â””â”€â”€ Returns: prediction_results with image_path & anomaly_score
    â”‚
    â”œâ”€â”€ STEP 2: Organize Images by Score
    â”‚   â””â”€â”€ organize_images_by_score
    â”‚       â”‚
    â”‚       â”œâ”€â”€ Setup Phase
    â”‚       â”‚   â”œâ”€â”€ create_score_folders
    â”‚       â”‚   â”‚   â””â”€â”€ Creates folders for each threshold
    â”‚       â”‚   â”‚
    â”‚       â”‚   â””â”€â”€ initialize_folder_stats
    â”‚       â”‚       â””â”€â”€ Initializes: {folder_name: {'count': 0, 'images': [], 'scores': []}}
    â”‚       â”‚
    â”‚       â”œâ”€â”€ Processing Phase (LOOP: for each prediction_result)
    â”‚       â”‚   â”œâ”€â”€ process_single_image_result
    â”‚       â”‚   â”‚   â”‚
    â”‚       â”‚   â”‚   â”œâ”€â”€ validate_prediction_result
    â”‚       â”‚   â”‚   â”‚   â””â”€â”€ Extracts: image_path, anomaly_score
    â”‚       â”‚   â”‚   â”‚
    â”‚       â”‚   â”‚   â”œâ”€â”€ save_image_by_score
    â”‚       â”‚   â”‚   â”‚   â”‚
    â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ get_image_parent_folder
    â”‚       â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Extracts parent folder name from path
    â”‚       â”‚   â”‚   â”‚   â”‚
    â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ determine_score_folder
    â”‚       â”‚   â”‚   â”‚   â”‚   â””â”€â”€ normalize_score_thresholds
    â”‚       â”‚   â”‚   â”‚   â”‚       â””â”€â”€ Sorts thresholds, returns default if None
    â”‚       â”‚   â”‚   â”‚   â”‚
    â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ build_target_folder_path
    â”‚       â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Combines: output_dir/parent_folder/folder_name
    â”‚       â”‚   â”‚   â”‚   â”‚
    â”‚       â”‚   â”‚   â”‚   â””â”€â”€ copy_or_move_file
    â”‚       â”‚   â”‚   â”‚       â””â”€â”€ Copies or moves file to destination
    â”‚       â”‚   â”‚   â”‚
    â”‚       â”‚   â”‚   â””â”€â”€ determine_score_folder (again for return value)
    â”‚       â”‚   â”‚       â””â”€â”€ normalize_score_thresholds
    â”‚       â”‚   â”‚
    â”‚       â”‚   â””â”€â”€ update_folder_stats
    â”‚       â”‚       â””â”€â”€ Updates: count++, images.append(), scores.append()
    â”‚       â”‚
    â”‚       â””â”€â”€ Finalization Phase
    â”‚           â”œâ”€â”€ save_all_folder_metadata (if save_metadata=True)
    â”‚           â”‚   â”‚
    â”‚           â”‚   â””â”€â”€ LOOP: for each folder with images
    â”‚           â”‚       â”œâ”€â”€ create_folder_metadata
    â”‚           â”‚       â”‚   â””â”€â”€ Creates dict with: threshold, count, avg/min/max scores, images
    â”‚           â”‚       â”‚
    â”‚           â”‚       â””â”€â”€ save_folder_metadata
    â”‚           â”‚           â””â”€â”€ Saves metadata to JSON file
    â”‚           â”‚
    â”‚           â”œâ”€â”€ print_organization_summary
    â”‚           â”‚   â””â”€â”€ Prints summary statistics
    â”‚           â”‚
    â”‚           â””â”€â”€ build_organization_stats
    â”‚               â””â”€â”€ Returns final statistics dictionary
    â”‚
    â””â”€â”€ STEP 3: Create Posters (OPTIONAL, if create_posters=True)
        â””â”€â”€ create_posters_for_score_folders
            â”‚
            â””â”€â”€ LOOP: for each score folder
                â””â”€â”€ LOOP: for each poster needed (based on images_per_poster)
                    â””â”€â”€ create_poster_from_folder
                        â”‚
                        â”œâ”€â”€ load_image_fast (for each image)
                        â”‚   â”‚
                        â”‚   â””â”€â”€ _load_image_cached (if cache=True)
                        â”‚       â””â”€â”€ LRU cache decorator
                        â”‚
                        â””â”€â”€ annotate_image_with_index (if annotate_with_index=True)
                            â””â”€â”€ Adds index number overlay to image


FUNCTION CATEGORIES
==================

ðŸ”µ UTILITY FUNCTIONS (Lowest Level - Reusable Building Blocks)
â”œâ”€â”€ normalize_score_thresholds
â”œâ”€â”€ get_image_parent_folder
â”œâ”€â”€ build_target_folder_path
â”œâ”€â”€ copy_or_move_file
â”œâ”€â”€ load_image_fast
â”œâ”€â”€ _load_image_cached
â””â”€â”€ validate_prediction_result

ðŸŸ¢ PROCESSING FUNCTIONS (Mid Level - Single Item Processing)
â”œâ”€â”€ determine_score_folder
â”œâ”€â”€ save_image_by_score
â”œâ”€â”€ process_single_image_result
â””â”€â”€ annotate_image_with_index

ðŸŸ¡ ORGANIZATION FUNCTIONS (Higher Level - Batch Processing)
â”œâ”€â”€ create_score_folders
â”œâ”€â”€ initialize_folder_stats
â”œâ”€â”€ update_folder_stats
â”œâ”€â”€ create_folder_metadata
â”œâ”€â”€ save_folder_metadata
â”œâ”€â”€ save_all_folder_metadata
â”œâ”€â”€ print_organization_summary
â””â”€â”€ build_organization_stats

ðŸŸ  WORKFLOW FUNCTIONS (Highest Level - Complete Workflows)
â”œâ”€â”€ create_image_index_dataframe
â”œâ”€â”€ organize_images_by_score
â”œâ”€â”€ create_poster_from_folder
â”œâ”€â”€ create_posters_for_score_folders
â””â”€â”€ predict_and_organize_by_score (MAIN ENTRY POINT)


EXECUTION SEQUENCE
==================

1. INITIALIZATION
   predict_and_organize_by_score
   â”œâ”€â”€ create_image_index_dataframe â†’ Creates index mapping
   â””â”€â”€ predict_image_list_from_file_enhanced â†’ Gets predictions

2. ORGANIZATION (for each image)
   organize_images_by_score
   â”œâ”€â”€ create_score_folders â†’ Setup folders
   â”œâ”€â”€ initialize_folder_stats â†’ Setup tracking
   â””â”€â”€ LOOP: process each image
       â”œâ”€â”€ validate_prediction_result â†’ Validate
       â”œâ”€â”€ save_image_by_score â†’ Save
       â”‚   â”œâ”€â”€ get_image_parent_folder â†’ Get parent
       â”‚   â”œâ”€â”€ determine_score_folder â†’ Determine folder
       â”‚   â”‚   â””â”€â”€ normalize_score_thresholds â†’ Normalize
       â”‚   â”œâ”€â”€ build_target_folder_path â†’ Build path
       â”‚   â””â”€â”€ copy_or_move_file â†’ Copy/move
       â””â”€â”€ update_folder_stats â†’ Update stats

3. METADATA & SUMMARY
   organize_images_by_score
   â”œâ”€â”€ save_all_folder_metadata â†’ Save JSON files
   â”œâ”€â”€ print_organization_summary â†’ Print summary
   â””â”€â”€ build_organization_stats â†’ Build final stats

4. POSTER CREATION (optional)
   create_posters_for_score_folders
   â””â”€â”€ LOOP: for each folder
       â””â”€â”€ create_poster_from_folder
           â”œâ”€â”€ load_image_fast â†’ Load images
           â””â”€â”€ annotate_image_with_index â†’ Add index (if enabled)


KEY INSIGHTS
============

1. Modularity: Each function has a single responsibility
2. Composability: Higher-level functions compose lower-level ones
3. Reusability: Utility functions can be used independently
4. Progressive Complexity: Simple functions build up to complex workflows
5. Optional Features: Poster creation is optional and can be disabled

